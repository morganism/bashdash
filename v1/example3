#!/usr/bin/env bash
source ~/bin/bashtui.sh

dashboard_init

# Register tasks
register_task "Download"
register_task "Disk Check"
register_task "Service X"

# Simulate task functions
download_task() {
    update_task_status "Download" 1
    for i in {1..100}; do
        sleep 0.05
        update_task_progress "Download" $i
    done
    update_task_status "Download" 2
}

disk_task() {
    update_task_status "Disk Check" 1
    sleep 3
    update_task_status "Disk Check" 2
}

service_task() {
    update_task_status "Service X" 1
    sleep 5
    update_task_status "Service X" 3
}

# Run tasks in background functions (same shell)
download_task & 
disk_task & 
service_task &

# Refresh loop
while :; do
    draw_dashboard
    sleep 0.1
    # Break when all tasks finished
    finished=true
    for status in "${task_status[@]}"; do
        [[ "$status" == 1 ]] && finished=false
    done
    $finished && break
done

dashboard_cleanup

